; ╔════════════════════════════════════════════════════════╗
; ║  ESP32-C3 Super Mini — PlatformIO (with WebSocket)    ║
; ╚════════════════════════════════════════════════════════╝

[platformio]
default_envs = esp32-c3-supermini

[env:esp32-c3-supermini]
platform = espressif32@6.12.0
board = esp32-c3-devkitm-1
framework = arduino

; ============================================
; Build / Compilergit gi
; ============================================
build_unflags = -Os
build_flags =
    -O2
    -std=gnu++17
    -Wall
    -Wextra

    ; USB CDC
    -D ARDUINO_USB_MODE=1
    -D ARDUINO_USB_CDC_ON_BOOT=1

    ; Debug
    -D CORE_DEBUG_LEVEL=3

; ============================================
; Upload / Monitor
; ============================================
upload_protocol = esptool
upload_speed = 460800

; Укажите ваш порт явно — раскомментируйте нужную строку:
; Windows:
; upload_port = COM3
; monitor_port = COM3
;
; Linux:
; upload_port = /dev/ttyACM0
; monitor_port = /dev/ttyACM0
;
; macOS:
; upload_port = /dev/cu.usbmodem101
; monitor_port = /dev/cu.usbmodem101

monitor_speed = 115200
monitor_filters =
    esp32_exception_decoder
    time
    ; colorize удалён — не поддерживается в текущей версии PlatformIO

; ============================================
; Flash / Memory (NO PSRAM!)
; ============================================
board_build.flash_mode = qio
board_build.f_flash = 80000000L
board_build.partitions = default.csv

; ============================================
; USB Serial Fixes (важно для C3)
; ============================================
board_build.usb_mode = cdc
board_build.usb_cdc = on

; ============================================
; Libraries
; ============================================
lib_deps =
    adafruit/Adafruit AHTX0@^2.0.5
    adafruit/Adafruit BusIO@^1.17.4
    links2004/WebSockets@^2.4.1

; ============================================
; Stability
; ============================================
upload_resetmethod = nodemcu
